---
title: "Testing"
author: "Justin L"
date: "4/4/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(ggplot2)
library(magrittr)
library(tidyr)
library(dplyr)
library(justinmisc)
```

```{r}
#Training data 1

set.seed(6227)
group1.x <- runif(n = 300)
group1.y <- runif(n = 300)
group2.x <- runif(n = 300, min = -1, max = .5)
group2.y <- runif(n = 300, min = -1, max = .1)

g1 <- cbind(group1.x,group1.y, rep("g1",300))
colnames(g1) <- c("x","y","group")
g2 <- cbind(group2.x,group2.y, rep("g2",300))
colnames(g2) <- c("x","y","group")

train <- as.data.frame(rbind(g1,g2))
train <- justinmisc::correct.mode(train,c("num","num","Factor"))
train$z <- runif(300)
ggplot(train, aes(x,y, color = group)) +
  geom_point()

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
layer1 <- aiRlayer(2,4)
layer2 <- aiRlayer(4,2)
mylayers <- list(layer1, layer2)
```


```{r}
train <- rbind(train, data.frame(x = c(.7, .9, .6, -.7,-.9,-.6),
                        y = c(-.7,-.6,-.9, .5, .3, .8),
                        group = c("g2","g2","g2","g1","g1","g1"),
                        z = c(.1,.2,.4,.5,.7,-.8)))
train <- train[,-4]
loss.aiR <- aiRrun(data = train,var.classify = "group",layers = mylayers, sample.size = .5,cycles = 300,batch.size = 60)
```
```{r}
loss.aiR$loss$iteration <- as.numeric(rownames(loss.aiR$loss))
ggplot(data = loss.aiR$loss,aes(x = iteration)) +
  geom_point(aes(y = train,color = "train")) +
  geom_point(aes(y = test, color = "test")) +
  coord_cartesian(ylim = c(0,max(loss.aiR$loss[,-3])))
  theme(axis.text.x = element_text(angle = 90))
```



```{r}
new <- aiRvisual(data = train[,-3], layers = loss.aiR$layers, range.size = 10000)
```

```{r}
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = new$layer1[,1])) +
  scale_color_gradient2(low = "orange", mid = "white", high = "blue")
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = new$layer1[,2])) +
  scale_color_gradient2(low = "orange", mid = "white", high = "blue")
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = new$layer1[,3])) +
  scale_color_gradient2(low = "orange", mid = "white", high = "blue")
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = new$layer1[,4])) +
  scale_color_gradient2(low = "orange", mid = "white", high = "blue")
```
```{r}
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = new$layer2[,1])) +
  scale_color_gradient2(low = "orange", mid = "white", high = "blue")
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = new$layer2[,2])) +
  scale_color_gradient2(low = "orange", mid = "white", high = "blue")
```

```{r}
classify_obj <- aiRclassify(data = new$data_model, factor = levels(train$group), layers = loss.aiR$layers)
```

```{r}
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = as.factor(classify_obj$classify), alpha = classify_obj$node.max)) 
```

```{r}
aiRrate(data = train, factor = "group", layers = loss.aiR$layers)
```


```{r}
.new2 <- aiRrun(data = train, var.classify = "group", layers = .new2$layers,cycles = 4, sample.size = .9,batch.size = 60)
.new <- aiRclassify(data = new$data_model, factor = levels(train[,3]), layers = .new2$layers)
ggplot(as.data.frame(new$data_model), aes(x = x, y = y)) +
  geom_point(aes(color = as.factor(.new$classify), alpha = .new$node.max)) 
```

